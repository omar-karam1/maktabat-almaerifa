<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مكتبة المعرفة | إنشاء حساب</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
 
    <link rel="stylesheet" href="/assets/css/register.css">
    <link rel="stylesheet" href="/assets/css/main.css">
  <style>
    

    /* تنسيقات عامة */
body {
  font-family: 'Tajawal', sans-serif;
  background-color: #f4f6f9;
  margin: 0;
  padding: 0;
  color: #333;
}

/* شريط التنقل */
.navbar {
  background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  padding: 15px 0;
  position: sticky;
  top: 0;
  z-index: 1000;
}

.nav-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
}

.logo img {
  height: 40px;
}

.logo-text {
  display: flex;
  flex-direction: column;
  line-height: 1.1;
}

.logo-text span:first-child {
  font-size: 1.2rem;
  font-weight: 700;
  color: #fff;
}

.logo-text span:last-child {
  font-size: 0.9rem;
  font-weight: 500;
  color: #ecf0f1;
}

.nav-links {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
}

.nav-links li {
  margin-right: 20px;
}

.nav-links a {
  color: #ecf0f1;
  text-decoration: none;
  font-size: 1rem;
  padding: 10px 15px;
  position: relative;
  transition: all 0.3s;
}

.nav-links a.active {
  color: #e74c3c;
  font-weight: 500;
}

.nav-links a::after {
  content: '';
  position: absolute;
  bottom: 0;
  right: 0;
  width: 0;
  height: 3px;
  background-color: #e74c3c;
  transition: width 0.3s;
}

.nav-links a:hover::after,
.nav-links a.active::after {
  width: 100%;
  left: 0;
  right: auto;
}

/* صفحة إنشاء الحساب */
.auth-section {
  padding: 50px 20px;
  background-color: #f8f9fa;
}

.auth-container {
  max-width: 400px;
  margin: 0 auto;
  background-color: #fff;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.auth-header {
  text-align: center;
}

.auth-header h2 {
  font-size: 2rem;
  color: #2c3e50;
  margin-bottom: 10px;
}

.auth-header p {
  color: #7f8c8d;
  font-size: 1rem;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
}

.form-group input {
  width: 100%;
  padding: 12px;
  font-size: 1rem;
  border-radius: 5px;
  border: 1px solid #ccc;
}

.form-group input:focus {
  border-color: #3498db;
}

.error-message {
  color: red;
  font-size: 12px;
  margin-top: 5px;
}


button.btn-primary {
  width: 100%;
  padding: 12px;
  background-color: #3498db;
  color: #fff;
  border: none;
  border-radius: 5px;
  font-size: 1.2rem;
  cursor: pointer;
  transition: background-color 0.3s;
}

button.btn-primary:hover {
  background-color: #2980b9;
}

button.btn-primary:disabled {
  background-color: #bdc3c7;
  cursor: not-allowed;
}


.footer {
  background-color: #2c3e50;
  color: #ecf0f1;
  padding: 15px 0;
  text-align: center;
}

.footer p {
  margin: 0;
  font-size: 1rem;
}


#passwordError, #confirmPasswordError {
  color: red;
  font-size: 12px;
  margin-top: 5px;
  display: none; 
}

#birthDateError {
  color: red;
  font-size: 12px;
  margin-top: 5px;
}

/* الشروط والأحكام */
.checkbox-group {
  display: flex;
  align-items: center;
}

.checkbox-group input {
  margin-right: 10px;
}

.checkbox-group a {
  color: #3498db;
  text-decoration: none;
}

.checkbox-group a:hover {
  text-decoration: underline;
}

/* تكيف مع الأجهزة الصغيرة */
@media (max-width: 768px) {
  .auth-container {
    padding: 20px;
  }

  .auth-header h2 {
    font-size: 1.8rem;
  }
  
  .auth-header p {
    font-size: 1rem;
  }
  
  .form-group input {
    font-size: 0.9rem;
  }

  button.btn-primary {
    font-size: 1rem;
  }
}


#passwordError, #confirmPasswordError {
  color: red;
  font-size: 12px;
  margin-top: 5px;
  display: none; 
}

  </style>
</head>
<body>
  <!-- الجزء العلوي (نفسه بدون تغيير) -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo">
       <img src="l.png" alt="شعار مكتبة المعرفة">
        <div class="logo-text">
          <span>مكتبة</span>
          <span>المعرفة</span>
        </div>
      </a>
      <ul class="nav-links">
        <li><a href="../index.html">الرئيسية</a></li>
        <li><a href="../pages/books.html">الكتب</a></li>
        <li><a href="../pages/authors.html">المؤلفون</a></li>
        <li><a href="../pages/login.html">تسجيل الدخول</a></li>
        <li><a href="../pages/register.html" class="active">إنشاء حساب</a></li>
      </ul>
      <div class="mobile-menu-btn">
        <i class="fas fa-bars"></i>
      </div>
    </div>
  </nav>

  <section class="auth-section">
    <div class="auth-container">
      <div class="auth-header">
        <h2>إنشاء حساب جديد</h2>
        <p>انضم إلى مجتمع مكتبة المعرفة اليوم</p>
      </div>
      
      <form id="registerForm" class="auth-form">
        <div class="form-group">
          <label for="name">الاسم الكامل</label>
          <input type="text" id="name" name="name" placeholder="أدخل اسمك الكامل" required>
          <div class="error-message" id="nameError"></div>
        </div>
        
        <div class="form-group">
          <label for="userName">اسم المستخدم</label>
          <input type="text" id="userName" name="userName" placeholder="أدخل اسم المستخدم" required>
          <div class="error-message" id="userNameError"></div>
        </div>
        
        <div class="form-group">
          <label for="email">البريد الإلكتروني</label>
          <input type="email" id="email" name="email" placeholder="أدخل بريدك الإلكتروني" required>
          <div class="error-message" id="emailError"></div>
        </div>
        
        <div class="form-group">
          <label for="password">كلمة المرور</label>
          <input type="password" id="password" name="password" placeholder="أدخل كلمة المرور" required minlength="6">
          <div class="error-message" id="passwordError"></div>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">تأكيد كلمة المرور</label>
          <input type="password" id="confirmPassword" name="confirmPassword" placeholder="أعد إدخال كلمة المرور" required>
          <div class="error-message" id="confirmPasswordError"></div>
        </div>
        
        <div class="form-group">
          <label for="birthDate">تاريخ الميلاد</label>
          <input type="date" id="birthDate" name="birthDate" required>
          <div class="error-message" id="birthDateError"></div>
        </div>
        
        <div class="form-group checkbox-group">
          <input type="checkbox" id="agreeTerms" required>
          <label for="agreeTerms">أوافق على <a href="#">الشروط والأحكام</a> و<a href="#">سياسة الخصوصية</a></label>
        </div>
        
        <button type="submit" class="btn btn-primary btn-block" id="registerBtn">
          <span id="registerText">إنشاء حساب</span>
          <div id="registerSpinner" class="spinner d-none"></div>
        </button>
        
        <div class="auth-footer">
          <p>لديك حساب بالفعل؟ <a href="login.html">سجل الدخول الآن</a></p>
        </div>
      </form>
    </div>
  </section>

  <footer class="footer">
    <p>© 2025 مكتبة المعرفة. جميع الحقوق محفوظة.</p>
  </footer>

 
  <script>

    document.getElementById("registerForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  // إخفاء الأخطاء السابقة
  document.querySelectorAll(".error-message").forEach(el => {
    el.textContent = "";
    el.style.display = "none";
  });

  const name = document.getElementById("name").value.trim();
  const userName = document.getElementById("userName").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  const confirmPassword = document.getElementById("confirmPassword").value;
  const birthDate = document.getElementById("birthDate").value;
  const agreeTerms = document.getElementById("agreeTerms").checked;

  let isValid = true;

  // تحقق من تفريغ الحقول
  if (!name) {
    document.getElementById("nameError").textContent = "الاسم مطلوب";
    document.getElementById("nameError").style.display = "block";
    isValid = false;
  }

  if (!userName) {
    document.getElementById("userNameError").textContent = "اسم المستخدم مطلوب";
    document.getElementById("userNameError").style.display = "block";
    isValid = false;
  }

  if (!email) {
    document.getElementById("emailError").textContent = "البريد الإلكتروني مطلوب";
    document.getElementById("emailError").style.display = "block";
    isValid = false;
  }

  if (!birthDate) {
    document.getElementById("birthDateError").textContent = "تاريخ الميلاد مطلوب";
    document.getElementById("birthDateError").style.display = "block";
    isValid = false;
  }

  if (!agreeTerms) {
    alert("يجب الموافقة على الشروط والأحكام.");
    isValid = false;
  }

  // تحقق من قوة كلمة المرور
  const passwordRegex = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*()_+{}\[\]:;"'<>,.?/~\\-]).{9,}$/;
  if (!passwordRegex.test(password)) {
    document.getElementById("passwordError").textContent =
      "كلمة المرور يجب أن تكون على الأقل 9 أحرف وتحتوي على أحرف وأرقام وعلامة خاصة";
    document.getElementById("passwordError").style.display = "block";
    isValid = false;
  }

  // تحقق من تطابق كلمة المرور
  if (password !== confirmPassword) {
    document.getElementById("confirmPasswordError").textContent = "كلمتا المرور غير متطابقتين";
    document.getElementById("confirmPasswordError").style.display = "block";
    isValid = false;
  }

  if (!isValid) return;

  // تحقق من تميز اسم المستخدم والبريد
  try {
    const [userNameRes, emailRes] = await Promise.all([
      fetch(`https://projectlibraryapi.runasp.net/api/User/IsUserNameUnique?userName=${encodeURIComponent(userName)}`),
      fetch(`https://projectlibraryapi.runasp.net/api/User/IsEmailUnique?email=${encodeURIComponent(email)}`)
    ]);

    const isUserNameUnique = await userNameRes.json();
    const isEmailUnique = await emailRes.json();

    if (!isUserNameUnique) {
      document.getElementById("userNameError").textContent = "اسم المستخدم مستخدم من قبل";
      document.getElementById("userNameError").style.display = "block";
      return;
    }

    if (!isEmailUnique) {
      document.getElementById("emailError").textContent = "البريد الإلكتروني مستخدم من قبل";
      document.getElementById("emailError").style.display = "block";
      return;
    }
  } catch (error) {
    alert("فشل في التحقق من البريد أو اسم المستخدم");
    console.error(error);
    return;
  }

  // إعداد وإرسال البيانات إلى الـ API
  const userData = {
    name,
    userName,
    email,
    password,
    birthDate
  };

  const registerBtn = document.getElementById("registerBtn");
  const registerText = document.getElementById("registerText");
  const registerSpinner = document.getElementById("registerSpinner");

  registerBtn.disabled = true;
  registerText.textContent = "جاري الإنشاء...";
  registerSpinner.classList.remove("d-none");

  try {
    const response = await fetch("https://projectlibraryapi.runasp.net/api/User/register", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(userData)
    });

    const result = await response.json();

    if (response.ok) {
      alert("تم إنشاء الحساب بنجاح!");
      window.location.href = "login.html";
    } else {
      alert(result.message || "فشل في إنشاء الحساب.");
    }
  } catch (error) {
    alert("حدث خطأ أثناء الاتصال بالخادم.");
    console.error(error);
  } finally {
    registerBtn.disabled = false;
    registerText.textContent = "إنشاء حساب";
    registerSpinner.classList.add("d-none");
  }
});

  </script>
</body>
</html>
